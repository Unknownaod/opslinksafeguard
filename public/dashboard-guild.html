<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport"content="width=device-width,initial-scale=1.0"/>
<title>Manage Guild â€“ Safeguard</title>
<link rel="icon" href="/assets/Safeguard-Bot.png"/>
<style>
body{background:#050816;color:#e5e7eb;font-family:"Segoe UI",sans-serif;margin:0;}
header{display:flex;justify-content:space-between;align-items:center;padding:20px 50px;background:rgba(10,15,25,0.7);border-bottom:1px solid rgba(255,255,255,0.05);}
header span{color:#ff6600;font-weight:600;font-size:1.3rem;}
.module{background:#0b1220;border-radius:12px;padding:20px;margin:20px auto;max-width:600px;border:1px solid rgba(255,255,255,0.05);}
.module h3{color:#ff6600;margin-bottom:10px;}
.toggle{display:flex;justify-content:space-between;align-items:center;}
button{background:#ff6600;border:none;color:#fff;padding:10px 22px;border-radius:8px;cursor:pointer;font-weight:600;}
button:hover{background:#ff944d;}
</style>
</head>
<body>
<header>
  <span id="guildName">Loading...</span>
  <button onclick="window.location='/dashboard'">Back</button>
</header>

<div id="modulesContainer" style="max-width:700px;margin:auto;margin-top:30px;text-align:center;">
  <p>Loading modules...</p>
</div>

<script>
const guildId = window.location.pathname.split("/").pop();
document.getElementById("guildName").textContent = `Server: ${guildId}`;
const container = document.getElementById("modulesContainer");

async function loadModules(){
  const res = await fetch(`/api/modules/${guildId}`);
  const mods = await res.json();
  if(!Array.isArray(mods)){container.innerHTML="<p>Failed to load modules.</p>";return;}
  container.innerHTML="";
  mods.forEach(m=>{
    container.innerHTML += `
      <div class="module">
        <h3>${m.name}</h3>
        <div class="toggle">
          <p>${m.description}</p>
          <button onclick="toggleModule('${m.id}', this)">${m.enabled ? "Disable" : "Enable"}</button>
        </div>
      </div>`;
  });
}

async function toggleModule(id, btn){
  btn.disabled = true;
  const res = await fetch(`/api/modules/${guildId}/toggle/${id}`, {method:"POST"});
  const data = await res.json();
  if(data.success) btn.textContent = data.newState ? "Disable" : "Enable";
  btn.disabled = false;
}

loadModules();
</script>
</body>
</html>
